# Shai-Hulud 2025 Campaign - Video Pipeline Makefile
# Usage: make <target>

# Configuration
CAMPAIGN_DIR := $(shell pwd)
DOCS_DIR := $(CAMPAIGN_DIR)/docs
DATA_DIR := $(CAMPAIGN_DIR)/data
PROMPTS_DIR := $(CAMPAIGN_DIR)/prompts
AUDIO_DIR := $(CAMPAIGN_DIR)/audio
VIDEO_DIR := $(CAMPAIGN_DIR)/video

# Input files
PARADIGM_DOC := $(DOCS_DIR)/shai-hulud-paradigm.md
INTEL_NOTES := $(DATA_DIR)/raw/notes-snippets.md

# Output files
OUTLINE_JSON := $(DATA_DIR)/processed/outline.json
SCRIPT_LONGFORM := $(DATA_DIR)/processed/script-longform.md
SHORTS_SCRIPTS := $(DATA_DIR)/processed/shorts-scripts.md
SHOTLIST_JSON := $(DATA_DIR)/processed/shotlist.json
VOICEOVER_MP3 := $(AUDIO_DIR)/voiceover.mp3

# Default target
.PHONY: all
all: help

# Help target
.PHONY: help
help:
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘     Shai-Hulud 2025 Campaign - Video Pipeline Makefile      â•‘"
	@echo "â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£"
	@echo "â•‘  Targets:                                                    â•‘"
	@echo "â•‘    make outline   - Generate video outline from threat doc   â•‘"
	@echo "â•‘    make script    - Generate long-form script from outline   â•‘"
	@echo "â•‘    make shorts    - Generate YouTube Shorts scripts          â•‘"
	@echo "â•‘    make shotlist  - Generate Sora 2 shotlist from script     â•‘"
	@echo "â•‘    make audio     - Generate ElevenLabs voiceover            â•‘"
	@echo "â•‘    make sora      - Generate Sora 2 video clips              â•‘"
	@echo "â•‘    make pipeline  - Run full pipeline (outlineâ†’sora)         â•‘"
	@echo "â•‘    make clean     - Remove generated files                   â•‘"
	@echo "â•‘    make status    - Show pipeline status                     â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

# Step 1: Generate outline from threat doc
.PHONY: outline
outline:
	@echo "ðŸ“‹ Generating video outline..."
	@echo "Input: $(PARADIGM_DOC)"
	@echo "Prompt: $(PROMPTS_DIR)/01-threat-to-outline.md"
	@echo "Output: $(OUTLINE_JSON)"
	@echo ""
	@echo "TODO: Implement Gemini 3 API call"
	@echo "  python scripts/generate_outline.py \\"
	@echo "    --threat-doc $(PARADIGM_DOC) \\"
	@echo "    --prompt $(PROMPTS_DIR)/01-threat-to-outline.md \\"
	@echo "    --output $(OUTLINE_JSON)"

# Step 2: Generate long-form script from outline
.PHONY: script
script:
	@echo "ðŸ“ Generating long-form script..."
	@echo "Input: $(OUTLINE_JSON)"
	@echo "Prompt: $(PROMPTS_DIR)/02-outline-to-script.md"
	@echo "Output: $(SCRIPT_LONGFORM)"
	@echo ""
	@echo "TODO: Implement Gemini 3 API call"
	@echo "  python scripts/generate_script.py \\"
	@echo "    --outline $(OUTLINE_JSON) \\"
	@echo "    --prompt $(PROMPTS_DIR)/02-outline-to-script.md \\"
	@echo "    --output $(SCRIPT_LONGFORM)"

# Step 3: Generate YouTube Shorts scripts
.PHONY: shorts
shorts:
	@echo "ðŸŽ¬ Generating Shorts scripts..."
	@echo "Input: $(SCRIPT_LONGFORM)"
	@echo "Prompt: $(PROMPTS_DIR)/03-script-to-shorts.md"
	@echo "Output: $(SHORTS_SCRIPTS)"
	@echo ""
	@echo "TODO: Implement LLM API call"
	@echo "  python scripts/generate_shorts.py \\"
	@echo "    --script $(SCRIPT_LONGFORM) \\"
	@echo "    --prompt $(PROMPTS_DIR)/03-script-to-shorts.md \\"
	@echo "    --output $(SHORTS_SCRIPTS)"

# Step 4: Generate Sora 2 shotlist
.PHONY: shotlist
shotlist:
	@echo "ðŸŽ¥ Generating Sora 2 shotlist..."
	@echo "Input: $(SCRIPT_LONGFORM)"
	@echo "Prompt: $(PROMPTS_DIR)/04-script-to-shotlist.md"
	@echo "Output: $(SHOTLIST_JSON)"
	@echo ""
	@echo "TODO: Implement LLM API call"
	@echo "  python scripts/generate_shotlist.py \\"
	@echo "    --script $(SCRIPT_LONGFORM) \\"
	@echo "    --prompt $(PROMPTS_DIR)/04-script-to-shotlist.md \\"
	@echo "    --output $(SHOTLIST_JSON)"

# Step 5: Generate ElevenLabs voiceover
.PHONY: audio
audio:
	@echo "ðŸŽ™ï¸ Generating ElevenLabs voiceover..."
	@echo "Input: $(SCRIPT_LONGFORM)"
	@echo "Style: $(PROMPTS_DIR)/05-elevenlabs-style-note.md"
	@echo "Output: $(VOICEOVER_MP3)"
	@echo ""
	@echo "TODO: Implement ElevenLabs API call"
	@echo "  python scripts/generate_audio.py \\"
	@echo "    --script $(SCRIPT_LONGFORM) \\"
	@echo "    --voice-id YOUR_VOICE_ID \\"
	@echo "    --output $(VOICEOVER_MP3)"

# Step 6: Generate Sora 2 video clips
.PHONY: sora
sora:
	@echo "ðŸŽ¬ Generating Sora 2 video clips..."
	@echo "Input: $(SHOTLIST_JSON)"
	@echo "Output: $(VIDEO_DIR)/*.mp4"
	@echo ""
	@echo "TODO: Implement Sora 2 API call"
	@echo "  python scripts/generate_sora_clips.py \\"
	@echo "    --shotlist $(SHOTLIST_JSON) \\"
	@echo "    --output-dir $(VIDEO_DIR)"

# Run full pipeline
.PHONY: pipeline
pipeline: outline script shorts shotlist audio sora
	@echo ""
	@echo "âœ… Full pipeline complete!"
	@echo "Next: Import audio + video into DaVinci Resolve or Premiere Pro"

# Clean generated files
.PHONY: clean
clean:
	@echo "ðŸ§¹ Cleaning generated files..."
	rm -f $(OUTLINE_JSON)
	rm -f $(SCRIPT_LONGFORM)
	rm -f $(SHORTS_SCRIPTS)
	rm -f $(SHOTLIST_JSON)
	rm -f $(VOICEOVER_MP3)
	rm -f $(VIDEO_DIR)/*.mp4
	@echo "âœ… Clean complete"

# Show pipeline status
.PHONY: status
status:
	@echo "ðŸ“Š Pipeline Status"
	@echo "=================="
	@echo ""
	@echo "Source Documents:"
	@[ -f $(PARADIGM_DOC) ] && echo "  âœ… $(PARADIGM_DOC)" || echo "  âŒ $(PARADIGM_DOC) (MISSING)"
	@[ -f $(INTEL_NOTES) ] && echo "  âœ… $(INTEL_NOTES)" || echo "  âš ï¸  $(INTEL_NOTES) (optional)"
	@echo ""
	@echo "Generated Outputs:"
	@[ -f $(OUTLINE_JSON) ] && echo "  âœ… outline.json" || echo "  â¬œ outline.json"
	@[ -f $(SCRIPT_LONGFORM) ] && echo "  âœ… script-longform.md" || echo "  â¬œ script-longform.md"
	@[ -f $(SHORTS_SCRIPTS) ] && echo "  âœ… shorts-scripts.md" || echo "  â¬œ shorts-scripts.md"
	@[ -f $(SHOTLIST_JSON) ] && echo "  âœ… shotlist.json" || echo "  â¬œ shotlist.json"
	@[ -f $(VOICEOVER_MP3) ] && echo "  âœ… voiceover.mp3" || echo "  â¬œ voiceover.mp3"
	@echo ""
	@echo "Video Clips:"
	@ls -1 $(VIDEO_DIR)/*.mp4 2>/dev/null | wc -l | xargs -I {} echo "  {} clips generated"